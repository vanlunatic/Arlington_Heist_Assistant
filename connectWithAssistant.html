 <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Games 360: Arlington Heist</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
     let threadId = localStorage.getItem("threadId") || null;  // ✅ Store threadId in localStorage

async function sendMessage() {
  const userInput = document.getElementById("user-input");
  const chatBox = document.getElementById("chat-box");
  const userMessage = userInput.value.trim();

  if (!userMessage) return;

  chatBox.innerHTML += `<p><strong>You:</strong> ${userMessage}</p>`;
  userInput.value = "";

  try {
    const response = await fetch("/api/openai", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userMessage, threadId }),  // ✅ Send threadId with request
    });

    if (!response.ok) {
      throw new Error(await response.text());
    }

    const data = await response.json();
    const assistantMessage = data.result || "No response received.";
    threadId = data.threadId;  // ✅ Update threadId
    localStorage.setItem("threadId", threadId);  // ✅ Store it for future messages

    chatBox.innerHTML += `<p><strong>Assistant:</strong> ${assistantMessage}</p>`;
  } catch (error) {
    console.error("Error:", error);
    chatBox.innerHTML += `<p><strong>Error:</strong> ${error.message}</p>`;
  }
}


  </script>
</head>

<body>
  <h2>Suspect Interrogation</h2>
  <div id="chat-box"></div>
  <input type="text" id="user-input" placeholder="Type your message here..." />
  <button onclick="sendMessage()">Send</button>
</body>

</html>
